#!/bin/bash

echo "Изменяем hostname VM"
hostnamectl set-hostname wordpress #название устройства
systemctl restart systemd-hostnamed #перезапускаем службу
echo "Отключаем Firewall"
systemctl disable firewalld #удаляем из автозагрузки firewalld
systemctl stop firewalld #выключаем firewalld
echo "Устанавливаем другой Firewall"
dnf install -q -y iptables-services #устанавливаем iptables 
cp ./iptables /etc/sysconfig/iptables #копируем требуемые настройки
systemctl restart iptables #рестартуем службу
systemctl enable iptables #добавляем в автозагрузку
echo "Корректируем м сетевые настройки"
cp ./enp0s3.nmconnection /etc/NetworkManager/system-connections #копируем настройки сервера
systemctl restart NetworkManager #рестартуем сетевую службу
echo "Выключение Selinux"
sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config  #изменяем положение селинукс
setenforce 0 #выключаем селинукс
#установка докера
echo "Устанавливаем Docker"
sudo yum install -q -y yum-utils 
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo  #добавляем репозиторий для скачивания
sudo yum install -q -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
systemctl start docker #стартуем докер
systemctl enable docker #добавляем в автозагрузку
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
echo "Создаем каталог проекта для WordPress"
cd
mkdir wordpress 
cd wordpress
mkdir nginx-conf
cd /root/OTUS_PROJECT
cp ./nginx.conf /root/wordpress/nginx-conf
cp ./.env /root/wordpress
docker compose up -d
echo "Проверяем статус сервисов"
docker compose ps